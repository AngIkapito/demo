{% extends "includes/base.html" %}
{% load static %}
{% block content %}
<!-- DITO KA MAS START MAGLAGAY NG LAMAN NG BODY -->
<!-- Begin Page Content -->

<div class="card o-hidden border-0 shadow-lg my-5">
    <div class="card-body p-0">
        <!-- Nested Row within Card Body -->
        {% comment %} <div class="row"> {% endcomment %}
            {% comment %} <div class="col-lg-5 d-none d-lg-block bg-register-image">
                 <img src=" {% static "img/android-chrome-512x512.png" %} " class="img-fluid" alt="TracKaPSITElogo"> 
            </div>  {% endcomment %}
            <div class="col-lg-7">
                <div class="p-5">
                    <div class="text-center">
                        <h1 class="h4 text-gray-900 mb-4 text-left">Add Member</h1>
                    </div>

                    <form class="user" method="post" action=" {% url "add_member" %} " enctype="multipart/form-data" onsubmit="return validateForm()" >
                       {% csrf_token %}
                       
                    <fieldset>
                        <legend>For Access</legend>
                        <div class="form-group">
                            <label for="is_superuser" hidden>Is Superuser?</label>
                            <select class="form-control" id="is_superuser" name="is_superuser" hidden/>
                                    <option value="1">True</option>  <!-- Current salutation as default -->
                                    <option value="0" selected>False</option>  <!-- Default option if no salutation -->
                            </select> 
                         
                            <label for="is_active">Is Active?</label>
                            <select class="form-control" id="is_active" name="is_active" >
                                <option value="1" selected>True</option>  <!-- Current salutation as default -->
                                <option value="0">False</option>  <!-- Default option if no salutation -->
                            </select> 

                            <label for="user_type">User Type?</label>
                            <select class="form-control" id="user_type" name="user_type" required/>
                                <option value="" disabled selected>SELECT USER TYPE</option>  <!-- Default option -->
                                <option value="1">1 - PRESIDENT</option>
                                <option value="2">2 - OFFICER/AREA COORDINATOR</option>
                                <option value="3" selected>3 - MEMBER</option>
                            </select>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Member Information</legend>
                            <div class="form-group">
                                <label for="membership_type">Membership Type</label>
                                <select class="form-control" id="membership_type" name="membership_type" required/>
                                    <option value="" disabled selected>SELECT MEMBERSHIP TYPE</option>  <!-- Default option if no membership type is selected -->
                                    {% for membershiptype in membershiptypes %}
                                        <option value="{{ membershiptype.membershiptype_name }}">{{ membershiptype.membershiptype_name }}</option>
                                    {% endfor %}
                                </select>

                        <label for="member_type">Member Type</label>
                        <select class="form-control" id="member_type" name="member_type" required/>
                            <option value="" disabled selected>SELECT MEMBER TYPE</option>  <!-- Default option if no salutation -->
                            {% for membertype in membertypes %}
                                <option value="{{ membertype.membertype_name }}">{{ membertype.membertype_name }}</option>
                            {% endfor %}
                        </select>
                        
                        </div>

                    <div class="form-group">
                        <div class="form-group">
                            <label for="salutation">Salutation</label>
                            <select class="form-control" id="salutation" name="salutation" required/>
                            <option value="" disabled selected>SELECT SALUTATION</option>  <!-- Default option -->
                                {% for salutation in salutations %}
                                    <option value="{{ salutation.salutation_name }}">{{ salutation.salutation_name }}</option>  <!-- Display each salutation -->
                                {% endfor %}
                        </select>
                        </div>
                        <div class="form-group">
                            <label for="first_name">First Name</label>
                            <input type="text" style="text-transform: uppercase;" class="form-control  " id="first_name"
                                placeholder="First Name" name="first_name" required/>
                        </div>
                        <div class="form-group">
                            <label for="last_name">Last Name</label>
                            <input type="text" style="text-transform: uppercase;" class="form-control  " id="last_name"
                                placeholder="Last Name" name="last_name" required/>
                        </div>
                        <div class="form-group">
                            <label for="middle_name">Middle Name</label>
                            <input type="text" style="text-transform: uppercase;" class="form-control  " id="middle_name"
                                placeholder="Middle Name" name="middle_name"/>
                        </div>
                    </div>

                    
                    <div class="form-group">
                        <label>Profile Picture</label>
                        <input type="file" class="form-control" accept=".jpg, .jpeg, .png" name="profile_pic"/>
                     </div> 

                     <div class="form-group">
                        <label for="position">Position</label>
                        <input type="text" style="text-transform: uppercase;" class="form-control  " id="position"
                            placeholder="Position" name="position"  required/>
                    </div>
                        <div class="form-group">
                            <label for="email">Email Address</label>
                            <input type="email" class="form-control  " id="email"
                                placeholder="Email Address" name="email" required/>
                        </div>

                        <div class="form-group">
                            
                        <label for="contact_no">Contact Number</label>
                            <input type="text" class="form-control  " id="contact_no"
                                placeholder="Contact No. Ex. 09123456789" name="contact_no" maxlength="11" required/>
                        </div>
                        <div class="form-group">
                            <label for="birthdate">Birthdate</label>
                            <input type="date" class="form-control  " id="birthdate" name="birthdate" required/>
                        </div>
                        <div class="form-group">
                            <label for="fbProfileLink">Facebook Profile Link:</label>
                            <input type="url" class="form-control  " id="fbProfileLink" name="fbProfileLink" placeholder="https://www.facebook.com/yourprofile">
                        </div>
                        <div class="form-group">
                        <label for="proof_of_payment">Proof of Payment:</label>
                        <input type="file" class="form-control" id="proof_of_payment" name="proof_of_payment" accept=".pdf, .jpg, .jpeg, .png">
                        </div>

                        <div class="form-group">
                            <label for="payment_date">Payment Date:</label>
                            <input type="date" class="form-control" id="payment_date" name="payment_date" required/>
                        </div>
                    </fieldset>

                    <fieldset>
                        <legend>Login Information</legend>
                        <div class="form-group">
                            <label for="username">Username</label>
                            <input type="text" class="form-control" id="exampleInputUsername" placeholder="Username" name="username" required/>
                        </div>
                    
                        <div class="form-group row">
                           
                            <div class="col-sm-6 mb-3 mb-sm-0">
                                <label for="password">Password</label>
                                <div class="input-group">
                                <input type="password" class="form-control" id="password" placeholder="Type 'Sample#01'" name="password" required/>
                                <div class="input-group-append">
                                    <span class="input-group-text toggle-password" 
                                        onclick="togglePasswordVisibility()" 
                                        data-toggle="tooltip" 
                                        title="Show/Hide Password">
                                        <i class="fas fa-eye" id="eye-icon"></i>
                                    </span>
                                </div>
                                </div>
                            </div>

                            <div class="col-sm-6 mb-3 mb-sm-0">
                                <label for="repeatpassword">Repeat Password</label>
                                <input type="password" class="form-control" id="repeatpassword" placeholder="Type 'Sample#01'" name="repeatpassword" required/>
                                <label id="passwordError" class="form-label text-danger d-none">Passwords do not match.</label>
                            </div>

                            <ul>
                                <li>Your password can’t be too similar to your other personal information.</li>
                                <li>Your password must contain at least 8 characters.</li>
                                <li>Your password can’t be a commonly used password.</li>
                                <li>Your password can’t be entirely numeric.</li>
                            </ul>
                        </div>
                    </fieldset>
                    <div class="col-sm mb-3">
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="termsCheckbox" name="membershipAgreement" value="accepted">
                                I accept the terms of membership.
                            </label>
                        </div>
                        <div class="agreement">
                            If accepted for membership, I agree to comply with the requirements of the By-Laws, and all regulations adopted by the Society with full knowledge of the responsibility imposed upon me.
                        </div>
                        </div>

                            {% comment %} {% for message in messages %}
                            {% if message.tags == 'error' %}
                                <div id="notificationArea" class="alert alert-warning alert-dismissible fade show" role="alert">
                            <strong> {{message}}.</strong> 
                            <!--<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>-->
                            </div>
                            {% endif %}
                            {% empty %}
                            <p></p>
                            {% endfor %} {% endcomment %}

                    <button id="registerButton" class="btn btn-primary btn-block" type="submit" onclick="return validateForm()">Register</button>
                    
                    <hr>
                    <div id="notificationArea" class="alert alert-danger d-none" role="alert"></div>

                    {% comment %} <div class="text-center">
                        <a class="small" href="forgot_password.html">Forgot Password?</a>
                    </div>
                    <div class="text-center">
                        <a class="small" href="{% url 'login' %}">Already have an account? Login!</a>
                    </div> {% endcomment %}

<!-- Modal -->
<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="successModalLabel">Success</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                Member successfully added.
            </div>
            <div class="modal-footer">
                <a href="" class="btn btn-primary">Go to Add Member Page</a>
                <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script>
    function showSuccessModal() {
        $('#successModal').modal('show');
    }

    function onAccountCreated() {
        // Call the function to show the modal
        showSuccessModal();
    }

    function createAccount() {
        // Simulate account creation logic
        // Replace this with your actual account creation logic (e.g., AJAX call)
        setTimeout(() => {
            // Simulate success
            onAccountCreated();
        }, 1000);
    }
</script>

<script>
   function validateForm() {
        var checkbox = document.getElementById("termsCheckbox");
        var password = document.getElementById("password").value;
        var repeatPassword = document.getElementById("repeatpassword").value;
        var passwordError = document.getElementById("passwordError");
        var notificationArea = document.getElementById("notificationArea");
        
        // Clear previous notifications
        notificationArea.innerHTML = '';
        notificationArea.classList.add('d-none');
    
        // Validate checkbox
        if (!checkbox.checked) {
            notificationArea.innerHTML += "You must agree to the terms of service before registering.<br>";
            notificationArea.classList.remove('d-none');
            return false;
        }
    
        // Validate passwords
        if (password !== repeatPassword) {
            passwordError.classList.remove("d-none");
            notificationArea.innerHTML += "Passwords do not match.<br>";
            notificationArea.classList.remove('d-none');
            return false;
        } else {
            passwordError.classList.add("d-none");
        }
    
        // Additional password validation
        if (!isValidPassword(password)) {
            return false;
        }
    
        return true;
    }
    
    function isValidPassword(password) {
        // Check if the password is at least 8 characters long
        if (password.length < 8) {
            document.getElementById("notificationArea").innerHTML += "Password must be at least 8 characters long.<br>";
            document.getElementById("notificationArea").classList.remove('d-none');
            return false;
        }
    
        // Check if the password is all numeric
        if (/^\d+$/.test(password)) {
            document.getElementById("notificationArea").innerHTML += "Password cannot be all numeric.<br>";
            document.getElementById("notificationArea").classList.remove('d-none');
            return false;
        }
        
        // Check for common passwords
        async function fetchCommonPasswords() {
            const response = await fetch('https://github.com/danielmiessler/SecLists/blob/master/Passwords/Common-Credentials/10k-most-common.txt');
            return await response.json();
        }
        
        async function isPasswordCommon(password) {
            const commonPasswords = await fetchCommonPasswords();
            return commonPasswords.includes(password);
        }
        const commonPasswords = [
            "password", "123456", "123456789", "12345678", "12345", "1234567",
            "qwerty", "abc123", "password1", "iloveyou", "admin", "letmein",
            "welcome", "monkey", "1234", "123", "1q2w3e4r", "qwertyuiop"
        ];
    
        if (commonPasswords.includes(password.toLowerCase())) {
            document.getElementById("notificationArea").innerHTML += "Password is too common.<br>";
            document.getElementById("notificationArea").classList.remove('d-none');
            return false;
        }
    
        return true;
    }
</script>
{% comment %} <script>
    function validateForm() {
        var checkbox = document.getElementById("termsCheckbox");
        var password = document.getElementById("password").value;
        var repeatPassword = document.getElementById("repeatpassword").value;
        var passwordError = document.getElementById("passwordError");

        // Validate checkbox
        if (!checkbox.checked) {
            alert("You must agree to the terms of service before registering.");
            return false;
        }

        // Validate passwords
        if (password !== repeatPassword) {
            passwordError.classList.remove("d-none");
            return false;
        } else {
            passwordError.classList.add("d-none");
        }

        // Additional password validation
        if (!isValidPassword(password)) {
            return false;
        }

        return true;
    }

    function isValidPassword(password) {
        // Check if the password is at least 8 characters long
        if (password.length < 8) {
            alert("Password must be at least 8 characters long.");
            return false;
        }

        // Check if the password is all numeric
        if (/^\d+$/.test(password)) {
            alert("Password cannot be all numeric.");
            return false;
        }

        // Check for common passwords (you can expand this list)
        const commonPasswords = [
            "password", "123456", "123456789", "12345678", "12345", "1234567",
            "qwerty", "abc123", "password1", "iloveyou", "admin", "letmein",
            "welcome", "monkey", "1234", "123", "1q2w3e4r", "qwertyuiop"
        ];

        if (commonPasswords.includes(password.toLowerCase())) {
            alert("Password is too common.");
            return false;
        }

        return true;
    }
</script> {% endcomment %}


<script>
    // Get today's date
    const today = new Date();
    const year = today.getFullYear();
    const month = String(today.getMonth() + 1).padStart(2, '0'); // Months are zero-based
    const day = String(today.getDate()).padStart(2, '0');

    // Set the value of the date input to today's date
    document.getElementById('birthdate').value = `${year}-${month}-${day}`;
    document.getElementById('payment_date').value = `${year}-${month}-${day}`;
</script>

<script>
    function togglePasswordVisibility() {
        const passwordInput = document.getElementById('password','repeatPassword');
        const eyeIcon = document.getElementById('eye-icon');

        // Toggle the type attribute
        if (passwordInput.type === 'password') {
            passwordInput.type = 'text';
            eyeIcon.classList.remove('fa-eye'); // Corrected class name
            eyeIcon.classList.add('fa-eye-slash'); // Corrected class name
        } else {
            passwordInput.type = 'password';
            eyeIcon.classList.remove('fa-eye-slash'); // Corrected class name
            eyeIcon.classList.add('fa-eye'); // Corrected class name
        }
    }
</script>

<script>
    function generateUsername() {
        const firstName = document.getElementById('first_name').value.trim();
        const lastName = document.getElementById('last_name').value.trim();
        
        // Check if both fields are filled
        if (firstName && lastName) {
            // Generate a random number to append for uniqueness
            const randomNum = Math.floor(Math.random() * 1000); // Random number between 0 and 999

            // Create a username by combining parts of the names and the random number
            const username = `${firstName.toLowerCase().charAt(0)}${lastName.toLowerCase()}${randomNum}`;
            
            // Set the generated username in the input field
            document.getElementById('username').value = username;
        } else {
            // Clear the username field if either input is empty
            document.getElementById('username').value = '';
        }
    }
</script>

{% endblock  %}

